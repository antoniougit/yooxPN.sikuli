import csv
from datetime import datetime
from datetime import timedelta
Settings.AutoDetectKeyboardLayout = False
popup("Make sure the content is saved as \\Downloads\\pn.csv before proceeding!")
campaignName = input("Please enter Campaign Name:")
campaignName = "".join(campaignName.split())
linkURL = input("Please enter Deeplink URL:")
linkURL = "".join(linkURL.split()).replace("\"", "").replace("COUNTRY", "{{PROD_CONTACTS_LIST(COUNTRY_)}}").replace("GENDERLETTER", "{{" + campaignName + "(GENDER_LETTER)}}")
tp = linkURL[linkURL.index("tp=") + len("tp="):].split("&")[0]
scheduleMonth = campaignName.split("_")[3]
scheduleMonth = scheduleMonth[2:4]

variantContent=[]

with open("C:\\Users\\gachamnos\\Downloads\\pn.csv", 'rb') as csvfile:
    reader = csv.reader(csvfile, delimiter=",")
    next(reader, None)  
    for row in reader:
        if not "".join(row[1]).strip():
            continue
        else:
            variantContent.append(row[1].decode("utf-8"))
variantContent.insert(0, variantContent.pop())

variantNum = len(variantContent)
click("1631691197455.png")
sleep(0.2)
click(Pattern("1631691235418.png").targetOffset(16,0))
type("a", KeyModifier.CTRL)
type(Key.BACKSPACE)
paste(campaignName)
sleep(1)
click("1631691587025.png")
sleep(0.1)
click("1631691615721.png")
sleep(0.1)
click("1631691665008.png")
sleep(0.1)
click("1631691711440.png")
sleep(0.1)
paste(campaignName + "_CTRL")
click("1631691828955.png")
paste("tp_" + tp)
click("1631692530961.png")
wait("1631698301570.png",10)
click("1631698301570.png")
wait("1631698341731.png")
click("1631698341731.png")
sleep(0.2)
click(Pattern("1631698387855.png").similar(0.90))
sleep(0.1)
click("1631698433639.png")
type("a", KeyModifier.CTRL)
type(Key.BACKSPACE)
type("2")
click("1631698494919.png")
sleep(0.1)
click("1631698517389.png")
sleep(0.1)
click("1631692530961.png")
wait("1631698733533.png")
click("1631698733533.png")
wait("1631701113070.png",10)
click("1631701113070.png")
wait("1631698833022.png",10)
click("1631699381033.png")
for i in range(1, variantNum):
    variantName = "V" + str(i)
    wait("1631691587025.png")
    click(Pattern("1631699439910.png").similar(0.90).targetOffset(0,33))
    sleep(0.2)
    click("1631699482999.png")
    wait(Pattern("1631699581633.png").similar(0.60),10)
    click(Pattern("1631699581633.png").similar(0.60))
    sleep(1)
    wait(Pattern("1631699581633.png").similar(0.60))
    click(Pattern("1631699581633.png").similar(0.60))
    wait("1631692530961.png")
    type("a", KeyModifier.CTRL)
    type(Key.BACKSPACE)
    paste(campaignName + "_" + variantName)
    click("1631692530961.png")
    wait("1631698733533.png")
    click("1631698733533.png")
    wait("1631701113070.png")
    click("1631701113070.png")
    wait("1631698833022.png")
    click("1631699381033.png")
sleep(1)
click("1631692597267.png")
sleep(0.1)
click("1631694988767.png")
sleep(5)
type("f", KeyModifier.CTRL)
type(Key.BACKSPACE)
paste("PERSADO_COMPONENTS")
click("1631872081064.png")
sleep(0.5)
wait("1631692954775.png",10)
click("1631692954775.png")
wait(Pattern("1631693033057.png").similar(0.90).targetOffset(20,0),20)
click(Pattern("1631693033057.png").similar(0.90).targetOffset(20,0))
sleep(0.1)
click(Pattern("1631693144425.png").targetOffset(0,11))
sleep(0.2)
click("1631693501436.png")
type("a", KeyModifier.CTRL)
type(Key.BACKSPACE)
paste(campaignName)
click("1631693633403.png")
type(Key.BACKSPACE)
paste("PERSADO_CAMPAIGNS_2021_" + scheduleMonth)
click(Pattern("1631712731221.png").targetOffset(0,6))
sleep(7)
if variantNum == 3:
    click(Pattern("1631275709369.png").exact())
    keyDown(Key.CTRL)
    click(Pattern("1631275723520.png").exact())
    click(Pattern("1631275738175.png").exact())
    click(Pattern("1631275746946.png").exact())
    click(Pattern("1631275761808.png").exact())
    while not exists(Pattern("1631275791572.png").exact(),1):
        keyUp()
        type(Key.PAGE_DOWN)
        sleep(0.1)
        keyDown(Key.CTRL)
    click(Pattern("1631275791572.png").exact())
    keyUp()
    type(Key.DELETE)
    click(Pattern("1631545019382.png").similar(0.90))
    sleep(0.2)
    split = (34, 33, 33)
elif variantNum == 4:
    click(Pattern("1631275723520.png").exact())
    keyDown(Key.CTRL)
    click(Pattern("1631275738175.png").exact())
    click(Pattern("1631275746946.png").exact())
    click(Pattern("1631275761808.png").exact())
    while not exists(Pattern("1631275791572.png").exact(),1):
        keyUp()
        type(Key.PAGE_DOWN)
        sleep(0.1)
        keyDown(Key.CTRL)
    click(Pattern("1631275791572.png").exact())
    keyUp()
    type(Key.DELETE)
    click(Pattern("1631545019382.png").similar(0.90))
    sleep(0.2)
    split = (25, 25, 25, 25)
elif variantNum == 5:
    click(Pattern("1631275738175.png").exact())
    keyDown(Key.CTRL)
    click(Pattern("1631275746946.png").exact())
    click(Pattern("1631275761808.png").exact())
    while not exists(Pattern("1631275791572.png").exact(),1):
        keyUp()
        type(Key.PAGE_DOWN)
        sleep(0.1)
        keyDown(Key.CTRL)
    click(Pattern("1631275791572.png").exact())
    keyUp()
    type(Key.DELETE)
    click(Pattern("1631545019382.png").similar(0.90))
    sleep(0.2)
    split = (20, 20, 20, 20, 20)
else:
    split = (12, 11, 11, 11, 11, 11, 11, 11, 11)
for i in range(variantNum):
    if i == 0:
        variantName = "ctrl"
        doubleClick(Pattern("1631275177860.png").similar(0.94))
    else: 
        variantName = "v" + str(i)
        if i == 1:
            doubleClick(Pattern("1631275160823.png").exact())
        elif i == 2:
            doubleClick(Pattern("1631275693728.png").exact())
        elif i == 3:
            doubleClick(Pattern("1631275709369.png").exact())
        elif i == 4:
            doubleClick(Pattern("1631275723520.png").exact())
        elif i == 5:
            doubleClick(Pattern("1631275738175.png").exact())
        elif i == 6:
            doubleClick(Pattern("1631275746946.png").exact())
        elif i == 7:
            doubleClick(Pattern("1631275761808.png").exact())
        else:
            while not exists(Pattern("1631275791572.png").exact(),1):
                keyUp()
                type(Key.PAGE_DOWN)
                sleep(0.1)
                keyDown(Key.CTRL)
            doubleClick(Pattern("1631275791572.png").exact())
    click("1631262246734.png")
    click("1631262265870.png")
    wait("1631262891654.png",10)
    click(Pattern("1631262396549.png").similar(0.90))
    type("a", KeyModifier.CTRL)
    type(Key.BACKSPACE)
    paste(variantName)
    click("1631263116877.png")
    wait(Pattern("1631277267272.png").similar(0.90).targetOffset(484,0),60)
    click(Pattern("1631277267272.png").similar(0.90).targetOffset(484,0))
    type("f", KeyModifier.CTRL)
    type(Key.BACKSPACE)
    paste("YOOX (All - Production)")
    click(Pattern("1631265244840.png").exact().targetOffset(0,2))
    sleep(0.2)
    click(Pattern("1631277353712.png").similar(0.90).targetOffset(500,-1))
    type("f", KeyModifier.CTRL)
    type(Key.BACKSPACE)
    paste(campaignName + "_" + variantName)
    click(Pattern("1631265244840.png").exact().targetOffset(0,2))
    sleep(0.2)
    click(Pattern("1631276451846.png").similar(0.90).targetOffset(483,-3))
    type("f", KeyModifier.CTRL)
    type(Key.BACKSPACE)
    paste("SWRVE_ID")
    click(Pattern("1631265244840.png").exact().targetOffset(0,2))
    sleep(0.2)
    click(Pattern("1631265762597.png").similar(0.90).targetOffset(48,-1))
    paste(variantContent[i])
    type(Key.PAGE_DOWN)
    click(Pattern("1631266166509.png").similar(0.90).targetOffset(74,0))
    paste(linkURL)
    type(Key.PAGE_DOWN)
    click("1631266415356.png")
    wait(Pattern("1631266516087.png").similar(0.90),20)
    click(Pattern("1631266580615.png").similar(0.90).targetOffset(39,-35))
    sleep(0.2)
    click("1631262265870.png")
sleep(0.2)
doubleClick(Pattern("1631541637052.png").similar(0.90))
wait(Pattern("1631541732012.png").similar(0.90))
click(Pattern("1631541732012.png").similar(0.90).targetOffset(40,0))
type("a", KeyModifier.CTRL)
type(Key.BACKSPACE)
for i in range(variantNum):
    paste(str(split[i]))
    type(Key.TAB)
click("1631262265870.png")
sleep(0.2)
now = datetime.now()
dateFormat = "%I:%M %p"
currentTime = now.strftime("%I:%M %p")
proofTime = datetime.strptime(currentTime, dateFormat) - timedelta(hours=1) + timedelta(minutes=2)
proofTime = proofTime.strftime("%I:%M %p").lower()
doubleClick(Pattern("1631548770522.png").similar(0.90))
wait("1631548822374.png")
click(Pattern("1631548851757.png").similar(0.90))
sleep(0.2)
click(Pattern("1631548923150.png").similar(0.90).targetOffset(27,-10))
sleep(0.2)
click(Pattern("1631548990956.png").similar(0.90))
type("a", KeyModifier.CTRL)
type(Key.BACKSPACE)
paste(proofTime)
click("1631262265870.png")
sleep(0.2)
click(Pattern("1631693033057.png").similar(0.90))
wait("1631708732619.png")
popup("Configuration READY! Please change date and send proofs!")
